# 🎨 الدليل المرئي - نظام الصلاحيات وسجل الرقابة

## 📸 نظرة عامة على التغييرات

---

## 1️⃣ صفحة المصروفات (Expenses)

### قبل التطبيق ❌

```
┌─────────────────────────────────────────────────────────────┐
│  المصروفات                                                   │
├─────────────────────────────────────────────────────────────┤
│  الوصف        │ الفئة  │ المبلغ    │ التاريخ  │ الإجراءات │
├─────────────────────────────────────────────────────────────┤
│  مواد تسويق   │ إعلان  │ 500 ر.س  │ 25/12   │ ✏️ 🗑️     │
│  رواتب        │ إداري  │ 3000 ر.س │ 24/12   │ ✏️ ��️     │
└─────────────────────────────────────────────────────────────┘
        ⬆️ الموظف يرى زر الحذف 🗑️
```

### بعد التطبيق ✅

**للموظف (user):**
```
┌─────────────────────────────────────────────────────────────┐
│  المصروفات                                                   │
├─────────────────────────────────────────────────────────────┤
│  الوصف        │ الفئة  │ المبلغ    │ التاريخ  │ الإجراءات │
├─────────────────────────────────────────────────────────────┤
│  مواد تسويق   │ إعلان  │ 500 ر.س  │ 25/12   │ ✏️        │
│  رواتب        │ إداري  │ 3000 ر.س │ 24/12   │ ✏️        │
└─────────────────────────────────────────────────────────────┘
        ⬆️ لا يوجد زر حذف! ✅
```

**للمدير (admin):**
```
┌─────────────────────────────────────────────────────────────┐
│  المصروفات                                    [+ إضافة مصروف]│
├─────────────────────────────────────────────────────────────┤
│  الوصف        │ الفئة  │ المبلغ    │ التاريخ  │ الإجراءات │
├─────────────────────────────────────────────────────────────┤
│  مواد تسويق   │ إعلان  │ 500 ر.س  │ 25/12   │ ✏️ 🗑️     │
│  رواتب        │ إداري  │ 3000 ر.س │ 24/12   │ ✏️ 🗑️     │
└─────────────────────────────────────────────────────────────┘
        ⬆️ المدير يرى زر الحذف ✅
```

---

## 2️⃣ صفحة عهد الموظفين (Employee Balances)

### قبل التطبيق ❌

```
┌─────────────────────────────────────────────────────────────┐
│  سجل العهدة - أحمد محمد                                     │
├─────────────────────────────────────────────────────────────┤
│  التاريخ  │ النوع      │ المبلغ      │ السبب        │ 🗑️  │
├─────────────────────────────────────────────────────────────┤
│  28/12   │ صرف عهدة   │ 1000 ر.س   │ مصاريف تسويق │ 🗑️  │
│  25/12   │ تسوية عهدة │ -500 ر.س   │ استرداد      │ 🗑️  │
└─────────────────────────────────────────────────────────────┘
        ⬆️ الموظف يمكنه حذف سجلات العهدة! ❌
```

### بعد التطبيق ✅

**للموظف (user):**
```
┌─────────────────────────────────────────────────────────────┐
│  سجل العهدة - أحمد محمد                                     │
├─────────────────────────────────────────────────────────────┤
│  التاريخ  │ النوع      │ المبلغ      │ السبب              │
├─────────────────────────────────────────────────────────────┤
│  28/12   │ صرف عهدة   │ 1000 ر.س   │ مصاريف تسويق       │
│  25/12   │ تسوية عهدة │ -500 ر.س   │ استرداد            │
└─────────────────────────────────────────────────────────────┘
        ⬆️ لا يوجد زر حذف! ✅
```

**للمدير (admin):**
```
┌─────────────────────────────────────────────────────────────┐
│  سجل العهدة - أحمد محمد                      [عملية جديدة]│
├─────────────────────────────────────────────────────────────┤
│  التاريخ  │ النوع      │ المبلغ      │ السبب        │ 🗑️  │
├─────────────────────────────────────────────────────────────┤
│  28/12   │ صرف عهدة   │ 1000 ر.س   │ مصاريف تسويق │ 🗑️  │
│  25/12   │ تسوية عهدة │ -500 ر.س   │ استرداد      │ 🗑️  │
└─────────────────────────────────────────────────────────────┘
        ⬆️ المدير يرى زر الحذف ✅
```

---

## 3️⃣ صفحة سجل الأحداث (Audit Logs) - جديدة! 🆕

### واجهة سجل الأحداث (للمدير فقط)

```
┌──────────────────────────────────────────────────────────────────┐
│  🛡️  سجل الأحداث والرقابة                                       │
│  تتبع جميع العمليات والتحركات في النظام                          │
├──────────────────────────────────────────────────────────────────┤
│  🔍 [بحث في السجلات...]  [جميع الإجراءات ▼]  [🔄 تحديث]        │
├──────────────────────────────────────────────────────────────────┤
│  التاريخ والوقت        │ المستخدم │ الإجراء  │ نوع المورد       │
├──────────────────────────────────────────────────────────────────┤
│  30/12/2025 14:35:22   │ أحمد     │ حذف ❌   │ مصروف            │
│                         │          │          │ [عرض التفاصيل ▼] │
│                         │          │          │ المبلغ: 500      │
├──────────────────────────────────────────────────────────────────┤
│  30/12/2025 12:20:15   │ محمد     │ إنشاء ✅ │ مصروف            │
│                         │          │          │ [عرض التفاصيل ▼] │
│                         │          │          │ المبلغ: 1200     │
├──────────────────────────────────────────────────────────────────┤
│  29/12/2025 16:45:30   │ فاطمة    │ حذف ❌   │ معاملة عهدة      │
│                         │          │          │ [عرض التفاصيل ▼] │
│                         │          │          │ المبلغ: 800      │
├──────────────────────────────────────────────────────────────────┤
│  عرض 1 إلى 20 من 150                    [السابق]  [التالي]     │
└──────────────────────────────────────────────────────────────────┘
```

### للموظف (user):

```
┌──────────────────────────────────────────────────────────────────┐
│                                                                  │
│                         🛡️ غير مصرح                              │
│                                                                  │
│                  هذه الصفحة متاحة للمديرين فقط                  │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

## 4️⃣ القائمة الجانبية (Sidebar)

### القائمة الجديدة - قسم الإدارة

**للمدير:**
```
┌─────────────────────────┐
│  🏠 الرئيسية            │
│  ✅ لوحة التحكم         │
│  📄 التقارير            │
│                         │
│  🛒 الطلبات             │
│  🛍️  الطلبات الجديدة    │
│  🔒 الطلبات المقفلة     │
│                         │
│  💰 المالية             │
│  🚚 شركات الشحن         │
│  💳 طرق الدفع           │
│  💼 أرصدة الموظفين      │
│  👥 إدارة الموردين      │
│  💵 المصروفات           │
│                         │
│  🔧 الإدارة             │
│  🛡️  سجل الأحداث  ← 🆕 │
│  👤 إدارة المستخدمين    │
└─────────────────────────┘
```

**للموظف:**
```
┌─────────────────────────┐
│  🏠 الرئيسية            │
│  ✅ لوحة التحكم         │
│  📄 التقارير            │
│                         │
│  🛒 الطلبات             │
│  🛍️  الطلبات الجديدة    │
│  🔒 الطلبات المقفلة     │
│                         │
│  💰 المالية             │
│  🚚 شركات الشحن         │
│  💳 طرق الدفع           │
│  💼 أرصدة الموظفين      │
│  👥 إدارة الموردين      │
│  💵 المصروفات           │
│                         │
│  ❌ لا يوجد قسم إدارة   │
└─────────────────────────┘
```

---

## 5️⃣ الإشعارات (Toast Notifications)

### عند محاولة الحذف (موظف):

```
┌──────────────────────────────────────┐
│  ⚠️  غير مصرح لك بالحذف              │
└──────────────────────────────────────┘
```

### عند الحذف بنجاح (مدير):

```
┌──────────────────────────────────────┐
│  ✅  تم حذف المصروف بنجاح            │
└──────────────────────────────────────┘
```

### عند الحذف من العهدة (مدير):

```
┌──────────────────────────────────────┐
│  ✅  تم حذف العملية من عهده          │
└──────────────────────────────────────┘
```

### عند إضافة مصروف (أي مستخدم):

```
┌──────────────────────────────────────┐
│  ✅  تم إضافة المصروف بنجاح          │
└──────────────────────────────────────┘
```

---

## 6️⃣ قاعدة البيانات - الهيكل الجديد

### جدول system_logs (جديد):

```sql
┌──────────────────────────────────────────────────────┐
│  system_logs                                         │
├──────────────────────────────────────────────────────┤
│  id              UUID PRIMARY KEY                    │
│  user_id         UUID → user_profiles(id)            │
│  user_name       VARCHAR(255)                        │
│  action          VARCHAR(100)  ← create/delete/etc   │
│  resource_type   VARCHAR(100)  ← expense/custody     │
│  resource_id     UUID                                │
│  details         JSONB          ← {amount: 500}      │
│  ip_address      VARCHAR(45)                         │
│  user_agent      TEXT                                │
│  created_at      TIMESTAMP                           │
└──────────────────────────────────────────────────────┘
```

### جدول employee_balance_transactions (معدّل):

```sql
┌──────────────────────────────────────────────────────┐
│  employee_balance_transactions                       │
├──────────────────────────────────────────────────────┤
│  id              UUID PRIMARY KEY                    │
│  user_id         UUID                                │
│  amount          DECIMAL                             │
│  type            VARCHAR                             │
│  reason          TEXT                                │
│  transaction_date TIMESTAMP                          │
│  created_by      UUID                                │
│  created_at      TIMESTAMP                           │
│  accepted_at     TIMESTAMP  ← 🆕 جديد                │
│  accepted_by     UUID       ← 🆕 جديد                │
└──────────────────────────────────────────────────────┘
```

---

## 7️⃣ تدفق العمل (Workflow)

### حذف مصروف - المدير:

```
1. المدير يضغط زر الحذف 🗑️
         ↓
2. نافذة تأكيد: "هل أنت متأكد؟"
         ↓ (نعم)
3. التحقق من الصلاحية: isAdmin? ✅
         ↓
4. حذف من قاعدة البيانات
         ↓
5. تسجيل في system_logs:
   {
     action: "delete",
     resource_type: "expense",
     user_name: "أحمد"
   }
         ↓
6. إشعار نجاح: "تم الحذف بنجاح" ✅
```

### حذف مصروف - الموظف:

```
1. الموظف لا يرى زر الحذف! 🚫
         ↓
   (إذا حاول بطريقة ما)
         ↓
2. التحقق من الصلاحية: isAdmin? ❌
         ↓
3. إشعار خطأ: "غير مصرح لك بالحذف" ⚠️
         ↓
4. لا يحدث حذف ✅
```

---

## 📊 الخلاصة المرئية

### قبل:
```
┌─────────────────────────────────────┐
│  ❌ أي موظف يمكنه الحذف            │
│  ❌ لا يوجد سجل للعمليات           │
│  ❌ لا يوجد تتبع للمستخدمين        │
│  ❌ لا يوجد صفحة للسجلات           │
└─────────────────────────────────────┘
```

### بعد:
```
┌─────────────────────────────────────┐
│  ✅ المدير فقط يمكنه الحذف          │
│  ✅ سجل كامل لجميع العمليات         │
│  ✅ تتبع المستخدم والوقت            │
│  ✅ صفحة إدارية للسجلات            │
│  ✅ بحث وفلترة وpagination          │
│  ✅ عرض آمن للتفاصيل               │
└─────────────────────────────────────┘
```

---

## 🎨 الألوان والأيقونات

### الإجراءات:

- **إنشاء** ✅ → أخضر `bg-green-100 text-green-800`
- **حذف** ❌ → أحمر `bg-red-100 text-red-800`
- **تحديث** 🔄 → أزرق `bg-blue-100 text-blue-800`
- **قبول** ✅ → أخضر `bg-green-100 text-green-800`
- **رفض** ❌ → أحمر `bg-red-100 text-red-800`

### الأيقونات:

- **سجل الأحداث**: 🛡️ Shield
- **المستخدم**: 👤 User
- **الحذف**: 🗑️ Trash2
- **البحث**: 🔍 Search
- **التحديث**: 🔄 RefreshCw

---

**✨ تم تصميم الواجهة بعناية لتكون:**
- 📱 Responsive (متوافقة مع الجوال)
- 🎨 جميلة ومرتبة
- 🔒 آمنة ومحمية
- 📊 سهلة الفهم والاستخدام
- 🌍 RTL (من اليمين لليسار)
- 🇸🇦 بالعربية الكاملة
