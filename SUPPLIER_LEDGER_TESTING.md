# ุงุฎุชุจุงุฑ ูุธุงู ูุณุชุญูุงุช ุงูููุฑุฏูู

## ูุงุฆูุฉ ุงูุงุฎุชุจุงุฑุงุช

### 1๏ธโฃ ุงุฎุชุจุงุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### 1.1 ุงูุชุญูู ูู ุฅูุดุงุก ุงูุฌุฏุงูู
```sql
-- ูุฌุจ ุฃู ุชูุฑุฌุน ุงูุฌุฏุงูู ุงูุชุงููุฉ
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name IN ('supplier_ledger', 'supplier_payments');
```
โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุฌุฏูููู - `supplier_ledger` ู `supplier_payments`

#### 1.2 ุงูุชุญูู ูู ุงูู Indexes
```sql
SELECT indexname 
FROM pg_indexes 
WHERE tablename IN ('supplier_ledger', 'supplier_payments');
```
โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: 4 indexes ุนูู ุงูุฃูู

#### 1.3 ุงูุชุญูู ูู RLS
```sql
SELECT tablename, rowsecurity 
FROM pg_tables 
WHERE tablename IN ('supplier_ledger', 'supplier_payments');
```
โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: `rowsecurity = true` ููุฌุฏูููู

---

### 2๏ธโฃ ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช

#### 2.1 ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุฏูุฑ
```sql
SELECT 
  email,
  permissions->'supplier-ledger' as has_permission
FROM user_profiles
WHERE role = 'admin';
```
โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: `has_permission = true`

#### 2.2 ุงูุชุญูู ูู ุธููุฑ ุงููุงุฆูุฉ
- ุชุณุฌูู ุงูุฏุฎูู ููุฏูุฑ
- ุงูุชุญูู ูู ุธููุฑ "ูุณุชุญูุงุช ุงูููุฑุฏูู" ูู Sidebar
- ุงูููุฑ ุนูู ุงููุงุฆูุฉ ูุงูุชุญูู ูู ูุชุญ ุงูุตูุญุฉ ุจุฏูู ุฃุฎุทุงุก

---

### 3๏ธโฃ ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุณุชุญูุงุช ุนูุฏ ุฅููุงู ุงูุทูุจ

#### 3.1 ุงูุฎุทูุงุช
1. ุงูุฐูุงุจ ุฅูู "ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ"
2. ุงุฎุชูุงุฑ ุทูุจ ูุงุญุฏ ุฃู ุฃูุซุฑ
3. ุงูููุฑ ุนูู "ุฅููุงู ุงูุทูุจุงุช ูุน ุงูุชูุงููู ูุงูููุฑุฏูู"
4. ุฅุฏุฎุงู ุจูุงูุงุช ุงูููุฑุฏ ูุงูุชูููุฉ
5. ุฅุชูุงู ุนูููุฉ ุงูุฅููุงู

#### 3.2 ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
SELECT 
  sl.supplier_name,
  sl.order_id,
  sl.amount,
  sl.remaining_amount,
  sl.locked_by
FROM supplier_ledger sl
ORDER BY created_at DESC
LIMIT 5;
```
โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ูุณุชุญู ุฌุฏูุฏ ุชู ุฅูุดุงุคู ุจุงูุจูุงูุงุช ุงูุตุญูุญุฉ

#### 3.3 ุงูุชุญูู ูู Audit Log
```sql
SELECT 
  action,
  details
FROM user_activity_logs
WHERE action LIKE '%supplier_ledger%'
ORDER BY created_at DESC
LIMIT 5;
```
โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุณุฌู ุจู `supplier_ledger_create`

---

### 4๏ธโฃ ุงุฎุชุจุงุฑ ุนุฑุถ ุงููุณุชุญูุงุช

#### 4.1 ุงูุฎุทูุงุช
1. ุงูุฐูุงุจ ุฅูู "ูุณุชุญูุงุช ุงูููุฑุฏูู"
2. ุงูุชุญูู ูู ุธููุฑ ุฌููุน ุงููุณุชุญูุงุช ูู ุงูุฌุฏูู
3. ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ:
   - ุงุณู ุงูููุฑุฏ
   - ุฑูู ุงูุทูุจ
   - ุชูุงุตูู ุงูููุชุฌุงุช
   - ุงููุจูุบ ุงูุฃุตูู
   - ุงููุจูุบ ุงููุณุฏุฏ
   - ุงููุจูุบ ุงููุชุจูู
   - ูู ุฃููู ุงูุทูุจ
   - ุงูุชุงุฑูุฎ

โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุนุฑุถ ุฌููุน ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ

---

### 5๏ธโฃ ุงุฎุชุจุงุฑ ุณุฏุงุฏ ุฏูุนุฉ (ููุธู)

#### 5.1 ุงูุฅุนุฏุงุฏ
```sql
-- ุงูุชุฃูุฏ ูู ูุฌูุฏ ุฑุตูุฏ ููููุธู
UPDATE user_profiles 
SET current_balance = 10000 
WHERE email = 'employee@test.com';
```

#### 5.2 ุงูุฎุทูุงุช
1. ุชุณุฌูู ุงูุฏุฎูู ูููุธู
2. ุงูุฐูุงุจ ุฅูู "ูุณุชุญูุงุช ุงูููุฑุฏูู"
3. ุงูุชุญูู ูู ุนุฑุถ ุฑุตูุฏ ุงูุนูุฏุฉ ูู ุงูุฃุนูู
4. ุงุฎุชูุงุฑ ูุณุชุญู ุจู ูุจูุบ ูุชุจูู
5. ุงูููุฑ ุนูู ุฃููููุฉ ุงูุณุฏุงุฏ (๐ฒ)
6. ุฅุฏุฎุงู ูุจูุบ ุงูุณุฏุงุฏ (ุฃูู ูู ุฃู ูุณุงูู ุงูุฑุตูุฏ ูุงููุชุจูู)
7. ุฅุถุงูุฉ ููุงุญุธุงุช (ุงุฎุชูุงุฑู)
8. ุงูููุฑ ุนูู "ุชุฃููุฏ ุงูุณุฏุงุฏ"

#### 5.3 ุงูุชุญูู
```sql
-- ุงูุชุญูู ูู ุงูุณุฏุงุฏ
SELECT * FROM supplier_payments 
ORDER BY payment_date DESC 
LIMIT 1;

-- ุงูุชุญูู ูู ุชุญุฏูุซ ุงููุจูุบ ุงููุชุจูู
SELECT 
  supplier_name,
  amount,
  paid_amount,
  remaining_amount
FROM supplier_ledger 
WHERE id = '[ledger_id]';

-- ุงูุชุญูู ูู ุฎุตู ุงูุนูุฏุฉ
SELECT 
  amount,
  type,
  reason
FROM employee_balance_transactions 
ORDER BY created_at DESC 
LIMIT 1;

-- ุงูุชุญูู ูู ุฑุตูุฏ ุงูููุธู
SELECT current_balance 
FROM user_profiles 
WHERE email = 'employee@test.com';
```

โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- ุณุฌู ุฌุฏูุฏ ูู `supplier_payments`
- ุชุญุฏูุซ `remaining_amount` ู `paid_amount` ูู `supplier_ledger`
- ุณุฌู ุฎุตู ูู `employee_balance_transactions` ุจููุน `debit`
- ุงูุฎูุงุถ `current_balance` ุจูููุฉ ุงููุจูุบ ุงููุณุฏุฏ

---

### 6๏ธโฃ ุงุฎุชุจุงุฑ ุงูุชุญูู ูู ุงูุฑุตูุฏ

#### 6.1 ุงูุณููุงุฑูู 1: ุฑุตูุฏ ุบูุฑ ูุงูู
```sql
-- ุชูููู ุฑุตูุฏ ุงูููุธู
UPDATE user_profiles 
SET current_balance = 50 
WHERE email = 'employee@test.com';
```
- ูุญุงููุฉ ุณุฏุงุฏ ูุจูุบ 1000 ุฑ.ุณ
- โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุฑุณุงูุฉ ุฎุทุฃ "ุฑุตูุฏ ุงูุนูุฏุฉ ุบูุฑ ูุงูู"

#### 6.2 ุงูุณููุงุฑูู 2: ูุจูุบ ุฃูุจุฑ ูู ุงููุชุจูู
- ูุญุงููุฉ ุณุฏุงุฏ ูุจูุบ ุฃูุจุฑ ูู `remaining_amount`
- โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุฑุณุงูุฉ ุฎุทุฃ "ุงููุจูุบ ุฃูุจุฑ ูู ุงููุชุจูู"

---

### 7๏ธโฃ ุงุฎุชุจุงุฑ ุนุฑุถ ุณุฌู ุงูุณุฏุงุฏุงุช

#### 7.1 ุงูุฎุทูุงุช
1. ุงูููุฑ ุนูู ุฃููููุฉ ุงูุณุงุนุฉ (๐) ุจุฌุงูุจ ูุณุชุญู
2. ุงูุชุญูู ูู ุธููุฑ modal ุจุณุฌู ุงูุณุฏุงุฏุงุช
3. ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ:
   - ุงููุจูุบ ุงููุณุฏุฏ
   - ูู ุณุฏุฏ
   - ุงูุชุงุฑูุฎ ูุงูููุช
   - ุงูููุงุญุธุงุช

โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุนุฑุถ ุฌููุน ุงูุณุฏุงุฏุงุช ุจุดูู ุตุญูุญ ููุฑุชุจ ุญุณุจ ุงูุชุงุฑูุฎ

---

### 8๏ธโฃ ุงุฎุชุจุงุฑ ุญุฐู ูุณุชุญู (ูุฏูุฑ ููุท)

#### 8.1 ูููุธู
- ุชุณุฌูู ุงูุฏุฎูู ูููุธู
- ูุญุงููุฉ ุญุฐู ูุณุชุญู
- โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุนุฏู ุธููุฑ ุฒุฑ ุงูุญุฐู

#### 8.2 ููุฏูุฑ
1. ุชุณุฌูู ุงูุฏุฎูู ููุฏูุฑ
2. ุงูููุฑ ุนูู ุฃููููุฉ ุงูุญุฐู (๐๏ธ)
3. ุชุฃููุฏ ุงูุญุฐู

```sql
-- ุงูุชุญูู ูู ุงูุญุฐู
SELECT * FROM supplier_ledger 
WHERE id = '[deleted_ledger_id]';

-- ุงูุชุญูู ูู Audit Log
SELECT * FROM user_activity_logs 
WHERE action = 'supplier_ledger_delete' 
ORDER BY created_at DESC 
LIMIT 1;
```

โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
- ุญุฐู ุงููุณุชุญู
- ุญุฐู ุงูุณุฏุงุฏุงุช ุงููุฑุชุจุทุฉ (CASCADE)
- ุณุฌู ูู Audit Log

---

### 9๏ธโฃ ุงุฎุชุจุงุฑ Audit Log

#### 9.1 ุงูุชุญูู ูู ุชุณุฌูู ุฌููุน ุงูุนูููุงุช
```sql
SELECT 
  action,
  details->>'supplier' as supplier,
  details->>'amount' as amount,
  created_at
FROM user_activity_logs
WHERE action LIKE '%supplier%'
ORDER BY created_at DESC
LIMIT 10;
```

โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุณุฌู ููู ูู:
- `supplier_ledger_create`
- `supplier_payment_create`
- `supplier_ledger_delete`

---

### ๐ ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก

#### 10.1 ุงุฎุชุจุงุฑ ูุน ุจูุงูุงุช ูุจูุฑุฉ
```sql
-- ุฅูุดุงุก 100 ูุณุชุญู ูููู
INSERT INTO supplier_ledger (
  supplier_name, 
  order_id, 
  product_details, 
  amount, 
  remaining_amount, 
  locked_by,
  locked_by_user_id
)
SELECT 
  'ููุฑุฏ ' || i,
  'ORD-' || i,
  'ููุชุฌุงุช ูุชููุนุฉ',
  1000 + (i * 10),
  1000 + (i * 10),
  'Test User',
  (SELECT id FROM user_profiles WHERE role = 'admin' LIMIT 1)
FROM generate_series(1, 100) AS i;
```

- ุงูุชุญูู ูู ุณุฑุนุฉ ุชุญููู ุงูุตูุญุฉ
- โ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุชุญููู ุณุฑูุน (ุฃูู ูู 2 ุซุงููุฉ)

---

## ููุฎุต ูุนุงููุฑ ุงููุฌุงุญ

- โ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุดุฃุฉ ูุชุนูู
- โ ุตูุงุญูุงุช ูุญุฏุซุฉ ุจุดูู ุตุญูุญ
- โ ุงููุณุชุญูุงุช ุชููุดุฃ ุชููุงุฆูุงู ุนูุฏ ุฅููุงู ุงูุทูุจุงุช
- โ ุงูููุธู ูุณุชุทูุน ุงูุณุฏุงุฏ ููุท (ูุง ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู)
- โ ุฎุตู ุชููุงุฆู ูู ุนูุฏุฉ ุงูููุธู
- โ ุชุญุฏูุซ ุงููุจูุบ ุงููุชุจูู ุชููุงุฆูุงู
- โ ุฌููุน ุงูุนูููุงุช ูุณุฌูุฉ ูู Audit Log
- โ ูุงุฌูุฉ ุนุฑุถ ุงููุณุชุญูุงุช ุชุนูู ุจุดูู ุตุญูุญ
- โ Build ููุฌุญ ุจุฏูู ุฃุฎุทุงุก
- โ ูุง ุชูุฌุฏ ุชุณุฑูุจุงุช ุฃูููุฉ
